#+TAGS: encryption crypt disk_encryption luks


* Linux Unified Key Setup (LUKS)
* Description
LUKS is the standard for Linux hard disk encryption. By providing a standard on-disk-format, it does not only facilitate compatibility among distributions, but also provides secure management of multiple user passwords. In contrast to existing solution, LUKS stores all setup necessary setup information in the partition header, enabling the user to transport or migrate his data seamlessly.

* Usage
default cipher is aes-cbc-essiv:sha256 - 256 bits
default cipher used by Anaconda on RHEL/Centos is aes-xts-plain64 - 512 bits

** Unencrypt and mount a partition
1. identify the partition that you want to unencrypt
#+BEGIN_SRC sh
fdisk -l
#+END_SRC

2. Unencrypt the partition
#+BEGIN_SRC sh
udisksctl unlock -b /dev/sdb2
#+END_SRC
b - block device

3. Mount the partition
#+BEGIN_SRC sh
udisksctl mount -b /dev/mapper/enc_hdd
#+END_SRC

** Create a luks partition
- Makesure that the correct modules are installed
#+BEGIN_SRC sh
lsmod | grep dm_crypt
#+END_SRC

- if not then install
#+BEGIN_SRC sh
modprobe dm_crypt
lsmod | grep dm_crypt
#+END_SRC

- install the cryptsetup utility
#+BEGIN_SRC sh
yum install cryptsetup
#+END_SRC

- identify the device you would like to encrypt
#+BEGIN_SRC sh
fdisk -l
fdisk /dev/xvdf
#+END_SRC

- configure the partition table with fdisk
[[file://home/crito/Pictures/org/fdisk_create_partition0.png]]

[[file://home/crito/Pictures/org/fdisk_create_partition1.png]]

[[file://home/crito/Pictures/org/fdisk_create_partition2.png]]

[[file://home/crito/Pictures/org/fdisk_create_partition3.png]]

- Using cryptsetup prepare the partition to use LUKS and add the correct filesystem
[[file://home/crito/Pictures/org/cryptsetup_luks0.png]]

- Mount the newly create partition
#+BEGIN_SRC sh
mkdir /mnt/enc
mount /dev/mapper/enc_partition /mnt/enc
#+END_SRC

- confirm the mount
#+BEGIN_SRC sh
df -h
mount | grep enc_partition
#+END_SRC
enc_partition is the name that we gave when opening the partition

- to make the mount persistent over reboots edit the /etc/crypttab and /etc/fstab
/etc/crypttab
#+BEGIN_EXAMPLE
enc_partition /dev/xvfd1 none
#+END_EXAMPLE
/etc/fstab
#+BEGIN_EXAMPLE
/dev/mapper/enc_partition /mnt/enc ext4 defaults 1 2
#+END_EXAMPLE

- with Linux distros that use SELinux the contexts have to be applied
#+BEGIN_SRC sh
/sbin/restorecon -v -R /mnt/enc
#+END_SRC

* Lecture
* Tutorial
* Books
* Links
